import json
from pwn import *
from Crypto.Util.Padding import pad, unpad
from Crypto.Cipher import AES
import base64
from Crypto.Random import get_random_bytes

# prova = json.dumps({"username": "  true           }    ", "admin": False})
# print(prova)
# print(len(prova))
# obj = json.loads("{\"username\": \"  true}    \", \"admin\": false}")
# print(obj["admin"])
# print("Blocco 1: " + prova[0:16])
# print("Blocco 2: " + prova[16:32])
# print("Blocco 3: " + prova[32:48])
# print("Blocco 4: " + prova[48:64])
# print("Blocco 5: " + prova[64:80])

server = connect("130.192.5.212", "6551")  #{"username": "aa-true,           -              \"field          -              \":              -aaaa", "admin": false}&&&&&&&&&&&
print(server.recvline().decode())
name = b"aatrue,                          \"field                         \":              aaaa"
server.sendline(name)
token64 = server.recvline().decode().strip().split(':')[1][1:]
print("token: " + token64)
token = bytearray(base64.b64decode(token64))
print("token length: " + str(len(token)))
print(server.recv(1024).decode()) # what do you want to do?
true = token[16:32]
field = token[48:64]
closingQuotes = token[80:96]
false = token[112:128]
token[112:128] = true
token = bytes(token)
token += field
token += closingQuotes
token += false
server.sendline(b'flag')
print(server.recv(1024).decode()) #what is your token?
server.sendline(base64.b64encode(token))
print(server.recv(1024).decode())